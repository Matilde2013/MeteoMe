// AGGIUNGI QUESTO CODICE DENTRO IL TAG <script> DEL TUO FILE

// 1. Richiesta Permessi all'avvio
if ("Notification" in window) {
    Notification.requestPermission().then(permission => {
        if (permission === "granted") {
            console.log("Notifiche attivate!");
            programmaNotificaPromemoria();
        }
    });
}

// 2. Funzione per inviare una notifica immediata (es. per i traguardi)
function inviaNotifica(titolo, messaggio) {
    if (Notification.permission === "granted") {
        navigator.serviceWorker.ready.then(registration => {
            registration.showNotification(titolo, {
                body: messaggio,
                icon: 'https://cdn-icons-png.flaticon.com', // Icona meteo
                badge: 'https://cdn-icons-png.flaticon.com',
                vibrate: [200, 100, 200],
                tag: 'meteo-me-notifica'
            });
        });
    }
}

// 3. Logica per le notifiche basate sui dati
function controllaTraguardi(giorniConsecutivi) {
    if (giorniConsecutivi === 7) {
        inviaNotifica("Grande traguardo! ğŸ†", "Hai registrato il tuo meteo per 7 giorni consecutivi!");
    }
}

// 4. Esempio di analisi per la notifica settimanale
function analisiSettimanaleNotifica(emojiPrevalente) {
    let messaggio = "";
    if (emojiPrevalente === "ğŸŒª" || emojiPrevalente === "ğŸŒ©") {
        messaggio = "Questa settimana Ã¨ stata intensa... prenditi un momento per te. â˜•";
    } else if (emojiPrevalente === "ğŸŒˆ" || emojiPrevalente === "ğŸŒ") {
        messaggio = "Che bella settimana luminosa hai avuto! âœ¨";
    } else {
        messaggio = "Com'Ã¨ andata la tua settimana? Guarda le tue statistiche!";
    }
    inviaNotifica("Resoconto MeteoMe", messaggio);
}

// 5. Funzione per simulare il promemoria quotidiano
function programmaNotificaPromemoria() {
    // In un'app reale si usa l'API 'Periodic Sync', 
    // qui simuliamo un controllo al caricamento se oggi non hai ancora scritto nulla
    const oggi = new Date();
    const salvatoOggi = localStorage.getItem(`meteo-${oggi.getFullYear()}-${oggi.getMonth()}-${oggi.getDate()}`);
    
    if (!salvatoOggi) {
        setTimeout(() => {
            inviaNotifica("Che meteo hai oggi?", "Non dimenticare di segnare il tuo clima interiore! â˜ï¸ğŸŒ");
        }, 5000); // Appare dopo 5 secondi se non hai ancora inserito nulla
    }
}
